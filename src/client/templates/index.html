<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Distribuido IA - Cliente Web</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header { background-color: #2c3e50; color: white; padding: 20px 0; margin-bottom: 30px; }
        #logs { background-color: #1e1e1e; color: #00ff00; font-family: monospace; padding: 15px; height: 200px; overflow-y: auto; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="header text-center">
        <h1>Sistema Distribuido de Entrenamiento IA</h1>
        <p>Cliente Web</p>
    </div>

    <div class="container">
        <div class="row">
            <!-- Panel de Entrenamiento -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5>Entrenamiento</h5>
                    </div>
                    <div class="card-body">
                        <form id="trainForm">
                            <div class="mb-3">
                                <label class="form-label">Nombre del Modelo</label>
                                <input type="text" class="form-control" id="modelName" required placeholder="ej: modelo_v1">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Dataset (CSV)</label>
                                <input type="file" class="form-control" id="datasetFile" accept=".csv" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Iniciar Entrenamiento</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Panel de Predicción -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5>Predicción</h5>
                    </div>
                    <div class="card-body">
                        <form id="predictForm">
                            <div class="mb-3">
                                <label class="form-label">ID del Modelo</label>
                                <input type="text" class="form-control" id="predModelId" required placeholder="ej: modelo_v1_123456">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Datos de Entrada (separados por coma)</label>
                                <input type="text" class="form-control" id="inputVector" required placeholder="ej: 0.5, 0.1, 0.9">
                            </div>
                            <button type="submit" class="btn btn-success w-100">Realizar Predicción</button>
                        </form>
                        <div class="mt-3 p-3 bg-light border rounded text-center">
                            <strong>Resultado:</strong> <span id="predictionResult">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        <h5>Logs del Sistema</h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="logs"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function log(message, type='info') {
            const logs = document.getElementById('logs');
            const entry = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            if (type === 'error') entry.style.color = '#ff4444';
            if (type === 'success') entry.style.color = '#00ff00';
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
        }

        // Manejar Entrenamiento
        document.getElementById('trainForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const modelName = document.getElementById('modelName').value;
            const fileInput = document.getElementById('datasetFile');
            const file = fileInput.files[0];

            if (!file) return;

            const formData = new FormData();
            formData.append('model_name', modelName);
            formData.append('file', file);

            log(`Iniciando subida de dataset: ${file.name}...`);

            try {
                const response = await fetch('/train', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.success) {
                    log(`Entrenamiento completado! ID: ${data.modelId}`, 'success');
                } else {
                    log(`Error: ${data.error}`, 'error');
                }
            } catch (err) {
                log(`Error de red: ${err.message}`, 'error');
            }
        });

        // Manejar Predicción
        document.getElementById('predictForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const modelId = document.getElementById('predModelId').value;
            const inputVector = document.getElementById('inputVector').value;

            log(`Solicitando predicción al modelo ${modelId}...`);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        model_id: modelId,
                        input_vector: inputVector
                    })
                });
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('predictionResult').textContent = data.prediction;
                    log(`Modelo: ${modelId} Predicción: ${data.prediction}`, 'success');
                } else {
                    document.getElementById('predictionResult').textContent = "Error";
                    log(`Error: ${data.error}`, 'error');
                }
            } catch (err) {
                log(`Error de red: ${err.message}`, 'error');
            }
        });
    </script>
</body>
</html>